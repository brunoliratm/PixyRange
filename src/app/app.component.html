<div class="app-layout">
  <main class="main-content">
    <section class="mac-dashboard">
      <div class="input-panel">
        <header>
          <h2>PIXY RANGE</h2>
          <p class="subtitle">Enter parameters to compute distance.</p>
        </header>

        <div class="form-group">
          <app-exif-reader
            (focalLengthChange)="onFocalLengthChange($event)"
          ></app-exif-reader>
        </div>

        <div class="form-group">
          <label>Real Object Size <span class="unit">(cm)</span></label>
          <input
            class="clean-input"
            type="number"
            [ngModel]="realSize()"
            (ngModelChange)="realSize.set($event)"
            placeholder="e.g., 170"
          />
        </div>

        <div class="form-group">
          <label>Object Width on Sensor <span class="unit">(px)</span></label>
          <input
            class="clean-input"
            type="number"
            [ngModel]="objectSizeInImage()"
            (ngModelChange)="objectSizeInImage.set($event)"
            placeholder="e.g., 400"
          />
        </div>

        <div class="form-group">
          <label>Focal Length <span class="unit">(mm)</span></label>
          <input
            class="clean-input"
            type="number"
            [ngModel]="focalLength()"
            (ngModelChange)="focalLength.set($event)"
            placeholder="e.g., 50"
          />
        </div>
      </div>

      <div class="result-panel" [class.active]="distancia() !== null">
        <div class="formula-card">
          <span class="formula-label">Formula Logic</span>
          <div class="math-equation">
            <span class="var">D</span> =
            <span class="fraction">
              <span class="numerator">
                <span class="token r">{{ realSize() || "R" }}</span> Ã—
                <span class="token f">{{ focalLength() || "F" }}</span>
              </span>
              <span class="denominator">
                <span class="token i">{{ objectSizeInImage() || "I" }}</span>
              </span>
            </span>
          </div>
        </div>

        <div class="image-selection-container">
          <h4 class="image-selection-description">
            Select the width of the object in the image.
          </h4>
          <canvas
            id="myCanvas"
            #myCanvas
            (mousedown)="onCanvasMouseDown($event)"
            (mouseup)="onCanvasMouseUp($event)"
            (touchstart)="onCanvasTouchStart($event)"
            (touchend)="onCanvasTouchEnd($event)"
          ></canvas>
        </div>

        <div class="final-result">
          <span class="label">Calculated Distance</span>
          <h1 class="value">
            @if (distancia(); as dist) {
              {{ dist | number: "1.2-2" }} <span class="unit">m</span>
            } @else {
              ---
            }
          </h1>
        </div>
      </div>
    </section>
  </main>
</div>
